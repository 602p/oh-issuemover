{"status": "chatting", "priority": "feature", "title": "Add JSON API for the profile widget", "milestone": "later", "superceder": "", "nosylist": ["Mark, int3, paulproteus"], "assigned": "", "waitingon": "", "keywords": [], "id": "76", "files": [{"url": "http://openhatch.org/bugs/file17/0001-Add-JSON-support-for-the-widget.patch", "author": "int3"}, {"url": "http://openhatch.org/bugs/file18/0002-Add-link-to-JSON-API-for-profile.patch", "author": "int3"}], "history": [{"message": "Opening it back up.\n   \n", "author": "Mark"}, {"message": "Since I'll be working on general API's for the site, I'll go ahead and assign this \none to myself.\n   \n", "author": "Mark"}, {"message": "un-assigned - Now free for all to grab.\n   \n", "author": "palhmbs"}, {"message": "Hey int3, thanks for the code!\n\nIt looks like a bit more work will be needed to get this into shippable shape.\nTwo tasks in particular:\n\n== 1. JSON serialization of tags ==\n\nWhen I run the code with your patch included, and I load the widget for someone\nwho has the tag \"I will never understand Deleuze\", I get this traceback:\n\nTraceback:\nFile \"/home/raffi/oh/milestone-a/parts/mysite/django/core/handlers/base.py\" in\nget_response\n  99.                     response = callback(request, *callback_args,\n**callback_kwargs)\nFile \"/home/raffi/oh/milestone-a/mysite/profile/views.py\" in widget_display_json\n  174.     json = simplejson.dumps(data, cls=django_json_encoder)\nFile\n\"/home/raffi/oh/milestone-a/eggs/simplejson-2.1.1-py2.6-linux-i686.egg/simplejson/__init__.py\"\nin dumps\n  268.         use_decimal=use_decimal, **kw).encode(obj)\nFile\n\"/home/raffi/oh/milestone-a/eggs/simplejson-2.1.1-py2.6-linux-i686.egg/simplejson/encoder.py\"\nin encode\n  214.         chunks = self.iterencode(o, _one_shot=True)\nFile\n\"/home/raffi/oh/milestone-a/eggs/simplejson-2.1.1-py2.6-linux-i686.egg/simplejson/encoder.py\"\nin iterencode\n  282.             return _iterencode(o, 0)\nFile \"/home/raffi/oh/milestone-a/mysite/profile/views.py\" in default\n  170.             return simplejson.JSONEncoder.default(self, obj)\nFile\n\"/home/raffi/oh/milestone-a/eggs/simplejson-2.1.1-py2.6-linux-i686.egg/simplejson/encoder.py\"\nin default\n  190.         raise TypeError(repr(o) + \" is not JSON serializable\")\n\nException Type: TypeError at /people/rafpaf/openhatch-widget.json\nException Value: &lt;Tag: understands_not: Deleuze&gt; is not JSON serializable\n\n== 2. User privacy ==\n\nAnother task for you is to keep some of our users' data private. For instance,\ntags are public, but fields like these should be kept out of the JSON:\nlocation_confirmed, blacklisted_repository_committers, show_email,\nexpand_next_steps, dont_guess_my_location. That's an incomplete list. I suppose\nthe best solution is to JSON-ify only the fields you're interested in (projects,\ntags, etc.)\n\nThanks again for your contributions so far, int3!\n\n(By the way, Deleuze is &lt;<a href=\"http://en.wikipedia.org/wiki/Gilles_Deleuze\">http://en.wikipedia.org/wiki/Gilles_Deleuze</a>&gt;, a\ndifficult philosopher.)\n   \n", "author": "rafpaf"}, {"message": "Add a link to the widget JSON API.\n   \n", "author": "int3"}, {"message": "Add in changes from the previous review. Also, the last patch broke a number of \nthings, and I've fixed those as well.\n   \n", "author": "int3"}, {"message": "Patch review, 2010-05-10:\n\n&lt;paulproteus&gt; int3: You replace get_object_or_404 with Person.objects.filter()\n&lt;paulproteus&gt; Instead I'd prefer get_list_or_404 so we still get the 404\n&lt;<a href=\"http://docs.djangoproject.com/en/dev/topics/http/shortcuts/\">http://docs.djangoproject.com/en/dev/topics/http/shortcuts/</a>&gt;\n-*- paulproteus is still reading\n&lt;int3&gt; I realized get_list_or_404 returns a list, not a QuerySet. Let me see if\nthere's a 404 version of it.\n&lt;int3&gt; s/of it/of filter/\n&lt;paulproteus&gt; I think it returns a QuerySet\n-*- paulproteus checks\n&lt;paulproteus&gt; You're right!\n&lt;paulproteus&gt; Drat.\n&lt;paulproteus&gt; Would you be willing to write a helper in mysite/base/helpers.py ?\n&lt;int3&gt; okay, sure\n&lt;int3&gt; get_queryset_or_404 ?\n&lt;int3&gt; or rather\n&lt;int3&gt; filter_or_404\n&lt;paulproteus&gt; Yeah, sounds great.\n&lt;paulproteus&gt; Also you don't actually, on the web, *link* to the JSON file we\nnow export (-:\n&lt;paulproteus&gt; I'd like it if your patch did so. It'll require some thought to\nput the link in a sensible place.\n&lt;paulproteus&gt; I think that if you fix those issues, I'd very happily merge and\ndeploy this. Does that sound okay to you?\n&lt;int3&gt; yep, sure\n   \n", "author": "paulproteus"}]}