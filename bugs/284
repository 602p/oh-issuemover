{"status": "resolved", "priority": "bug", "title": "Send notifications *daily* rather than *weekly* upon someone clicking, \"I want to help\"", "milestone": "later", "superceder": "", "nosylist": ["abelian, becdot, egor83, jesstess, palhmbs, paulproteus, tsousa"], "assigned": "becdot", "waitingon": "", "keywords": ["bitesize, this-would-rock"], "id": "284", "files": [{"url": "http://openhatch.org/bugs/file523/0001-Changes-weekly_emails-to-daily_emails-all-over-hopef.patch", "author": "becdot"}, {"url": "http://openhatch.org/bugs/file524/0002-Migrates-updated-email_me_daily_re_projects-field.patch", "author": "becdot"}, {"url": "http://openhatch.org/bugs/file201/unnamed", "author": "abelian"}, {"url": "http://openhatch.org/bugs/file411/unnamed", "author": "BernardoPires"}], "history": [{"message": "I ran the following on the deployment:\n\n  Person.objects.all().values_list('email_me_re_projects', flat=True)\n\nand it showed me that there are some true values, and some false values, \nsuggesting that people's preferences have been properly retained.\n\nThanks!! Marking as resolved.\n   \n", "author": "paulproteus"}, {"message": "In <a href=\"https://github.com/openhatch/oh-\">https://github.com/openhatch/oh-</a>\nmainline/commit/fafd636947b6be2365674fbe7bd21cf4d7041403 + \n<a href=\"https://github.com/openhatch/oh-mainline/pull/80\">https://github.com/openhatch/oh-mainline/pull/80</a> this is resolved.\n\nThanks, becdot, for iterating on these changes and making them great! Deploying \nnow.\n   \n", "author": "paulproteus"}, {"message": "Correction: there was a problem with my development environment. The tests all \n*do* pass, as of origin/master at the moment; additionally, with your changes, \nthey also all pass. Sorry for the confusion.\n\n(Another advantage of Github pull requests is that a bot will automatically run \nthe test suite, and its environment is reliably correct.)\n   \n", "author": "paulproteus"}, {"message": "Wow, becdot, these changes are comprehensive!\n\nI have a few bits of feedback. First, general; then, specific.\n\nGeneral feedback:\n\n* Overall, the quality of your changes is outstanding.\n\n* You did a great, comprehensive job of looking for all relevant references to 'weekly' in the \ncode and adjusting them.\n\n* Great job writing a migration; this is essential, so thank you for taking care of it.\n\n* Considering all the above, I can see that this is the longest patch ever for a so-called \n\"bitesize\" task. So, thank you for tackling an issue like that!\n\n* You mentioned having an empty set of Projects in your local database. The two ways around that \nare, assuming you can run the site and view a development instance via 'python manage.py \nrunserver', (1) create a new project in your personal profile on your account on your \ndevelopment instance or (2) use 'python manage.py shell_plus' to get a Django/Python shell, then \ncall Project.create_dummy() (defined in mysite/search/models.py). That will create a project \nobject you can check out on the web. (A variant of this is to create a new Project object like: \nProject.objects.create(name='sample').)\n\n* If you want, you could submit a pull request on Github. It will probably be easier to do the \nreview that way -- it's easier on Github than here, and it's easy on Github to comment on \nindividual lines.\n\n* It's always great if you can pop into #openhatch and ask any questions you have as you work \nthrough bugs.\n\n* The 0001 patch is really long. Possibly, you could split up the changes there into lots of \nseparate commits; then, git format-patch would export each commit as a separate patch file.\n\nIs it a good idea to split it up? Usually I'm all for more commits, but in this case, I'm on the \nfence about this. On one hand, in favor of splitting it into pieces, it's hard to review as-is \nbecause it is so long. On the other hand, many of the changes are dependent on each other. If \nyou wanted to split it up, here are some segments that seem to be that they could be separate. \n(1) Rename the daily_email__list_of_people.html template and related templates, fixing up the \ncorresponding view function. (2) Make the rest of the changes in 0001. (3) Create your \nmigration, like you do in 0002.\n\nFor now, I'd say, the separation is fine as-is, but in the future, I'd warn the reviewer in the \npatch submission that it touches a lot of files, and give a rationale; for example, \"This \ntouches a lot of files because the 'weekly' assumption shows up a lot of places.\"\n\nOh, actually, as I write out that rationale, I realize another way to make more, easier-to-read \ncommits: First, do a a commit (or maybe a few small commits) to remove references to how often \nthe email gets sent from a lot of places. (To name two examples of this to illustrate the point, \nchanging mysite.base.views.test_weekly_email_re_projects to \nmysite.base.views.test_email_re_projects and simply removing \"weekly\" from comments, rather than \nchanging it to \"daily\".) These commits can stand on their own; they're code cleanups, and the \ntests will all pass unmodified (except for maybe truly trivial changes for the filename). (In \ngeneral, if you rename a file *and* modify it, it's harder to review; it's way easier to do a \nrename of a file first, and then a change in a later commit, because then git can detect the \nrename and show that to me, the reviewer.) Then, in a separate commit, now that the word \n'weekly' or constants like ONE_WEEK only appear where needed, you would change the logic and/or \nmove code around. That would be a small, surgical change probably; very easy to review.\n\n(The fact that you have to change all these variable names and filenames just to make a small, \nsurgical change is actually an indication of poor code quality in the OpenHatch codebase. I'm to \nblame for those choices, so please excuse my naivety in 2010.)\n\nWow, that all came out more long-winded than I thought. I hope it makes sense; I'm quite \navailable on IRC (which I'm faster at) to chat more.\n\nAgain, the extraction into smaller commits isn't necessarily a show-stopper.\n\nSpecific feedback:\n\n* In the migration, you delete the old column and create the new column, but that means any \nexisting preferences will get deleted. It's better to have three (!) migrations: one to create \nthe new column, another to copy the data, and a third to delete the old column. More info here: \n<a href=\"http://south.readthedocs.org/en/latest/tutorial/part3.html#data-migrations\">http://south.readthedocs.org/en/latest/tutorial/part3.html#data-migrations</a>\n\n* git warns me about \"whitespace errors\" in send_daily_emails.py -- on a few lines, there are ' \n' (space) characters at the end of the line, and git doesn't like that. It's just a warning, and \nit's okay to ignore it, but it's helpful to clean those up. Since your changes involve a rename, \nit's best to do the rename in a separate commit from changing this sort of whitespace issue. \n(You could even fix those whitespace problems in a commit *before* the rename commit.) The \nreason git warns about this is that if two files disagree about end-of-line space characters, it \ncan prevent git from cleanly merging changes sometimes. (That, the spaces just don't do \nanything, so might as well get rid of them.) (It's easy for me to see them when I do 'git diff -\n-color'.)\n\n* You add a \"TODO\" question in the test suite: \"Do we need to set seven_days_ago to yesterday \nsince emails are now sent daily?\" My answer is that yes, we need to test the new functionality. \nMake sure all the constants are adjusted for the new functionality. Luckily, you do test the new \nfunctionality below.\n\nOther things that occur to me as I read this code:\n\n* The push_to_end_of_list() function in send_daily_emails.py is a pretty silly function. But I'm \nto blame for that. What was I thinking?\n\n* We (the authors of this code in 2010) shouldn't have put _weekly_ into all those variable \nnames and filenames.\n\n* It seems that the automated tests in the \"profile\" app already fail, before your changes. \nThat's on us, the maintainers, not on you. I'll see if I can fix that shortly, because normally \nI would ask you to make sure that the test suite passes with your changes, but if it doesn't \npass now, figuring out if the failures are from your code or from our old code is a lot to ask.\n\nConclusion:\n\nRight now, before I can merge these patches, I'd need a fixed migration that retained the old \ndata. If you want to do the code cleanup above and make more commits that replace 0001, that'd \nbe fine too (though it's okay if not). Additionally, we should come to a decision about the TODO \nitem and remove the TODO note, one way or the other.\n\nSorry it took me a day to get to reviewing it. I will review follow ups faster, and also shorter \npatches I can always review faster. If you need clarification or help with any of the points \nabove, just let me know. (IRC is usually faster, but responses here are fine too.)\n\nThank you for submitting these changes! I'm looking forward to seeing them in a mergeable state, \nand then deploying them!\n   \n", "author": "paulproteus"}, {"message": "Hi, there! I'll review this shortly. It might take me until tomorrow to \nget to it.\n\nThank you for submitting it!\n   \n", "author": "paulproteus"}, {"message": "Attached is the migration patch\n   \n", "author": "becdot"}, {"message": "I changed the emails to send daily (no more than once every 24 hours), changed the variable \nemail_me_weekly_re_projects to email_me_daily_re_projects, and updated the tests and \ndocumentation.  I also created a new database migration in mysite/profile to reflect the changed \nvariable name -- please let me know if this was not the correct step to take.\n\nAll tests pass, and although I wasn't sure how to check manually for the change in the Projects \npage (due to the empty database), the change is reflected on \nopenhatch.org/account/settings/contact-info/ (email me daily about activity in my projects).\n\nPlease let me know whether any changes need to be made.\n\nThanks!\n\nBecca\n   \n", "author": "becdot"}, {"message": "becdot: that would be great! I've gone ahead and assigned it to you.\n   \n", "author": "jesstess"}, {"message": "It looks like this bug hasn't been touched in a while.  Would I be able to take a stab at it?\n   \n", "author": "becdot"}, {"message": "I will take this bug.\n   \n", "author": "tsousa"}, {"message": "Hi BernardnoPires and others,\n\nAs a mini-update, we've adjusted the development setup so that buildout isn't\nneeded at all.\n   \n", "author": "paulproteus"}, {"message": "Hi Asheesh,\n\nthank you for your e-mail. As I got stuck on the buildout process I removed\nmyself from the bug. As of now I don't have much time to take a look with\nit, but really, thanks for the heads up. When I have some spare time again\nI'll try to build it out, and when it works I'll search for a new bug to try\nto fix. :)\n\nCheers,\n\n2011/9/30 Asheesh Laroia &lt;<a href=\"mailto:bugs@openhatch.org\">bugs@openhatch.org</a>&gt;\n\n&gt;\n&gt; Asheesh Laroia &lt;<a href=\"mailto:asheesh@asheesh.org\">asheesh@asheesh.org</a>&gt; added the comment:\n&gt;\n&gt; Hi Bernardo!\n&gt;\n&gt; Are you still interested in this? It's been a bit; sorry we didn't get back\n&gt; to you.\n&gt;\n&gt; In the time since you first commented on this bug, we've made some\n&gt; improvements\n&gt; to the buildout process, in case you got stuck there!\n&gt;\n&gt; Let us know how you're progressing and if you're stuck anyway. You can\n&gt; always\n&gt; join us on #openhatch and chat with us, too!\n&gt;\n&gt; __________________________________________\n&gt; Roundup issue tracker &lt;<a href=\"mailto:bugs@openhatch.org\">bugs@openhatch.org</a>&gt;\n&gt; &lt;<a href=\"https://openhatch.org/bugs/issue284\">https://openhatch.org/bugs/issue284</a>&gt;\n&gt; __________________________________________\n&gt;\n   \n", "author": "BernardoPires"}, {"message": "Hi Bernardo!\n\nAre you still interested in this? It's been a bit; sorry we didn't get back to you.\n\nIn the time since you first commented on this bug, we've made some improvements\nto the buildout process, in case you got stuck there!\n\nLet us know how you're progressing and if you're stuck anyway. You can always\njoin us on #openhatch and chat with us, too!\n   \n", "author": "paulproteus"}, {"message": "Hello, I just wanted to say I want to try out helping an open source project and \nthis bitesized bug seems cool to begin with. I do have previous experience with \nDjango so hopefully I can sort this out quickly! Cheers\n   \n", "author": "BernardoPires"}, {"message": "I do think this is bitesized. It probably requires writing some high-quality \nEnglish text and a little (probably very little) Python code.\n\nTo tackle this, here is what you'd do:\n\n* Read mysite/profile/management/commands/profile_daily_tasks.py\n* Read mysite/profile/management/commands/send_weekly_emails.py\n\nOne thing you should know: On the server, we just run the profile_daily_tasks \nmanagement command. It runs daily, and if it has been long enough, it runs the \nweekly email sending.\n\nYou should, at that point, understand how the weekly notifications get sent.\n\n(If not, just ask us on #openhatch .)\n\nThen you'll need to change it so that they run daily. Any set of changes that you \nmake to achieve that are fine; I'm not super picky about the implementation. (For \nexample, you might remove the send_weekly_emails management command and make its \nbody part of the profile_daily_tasks file. Actually, that seems good; then make \nthe daily notification sending be a method on the Command class in that file.)\n\nMake sure to update the test suite, too.\n\nThen, submit a patch!\n   \n", "author": "paulproteus"}, {"message": "Setting this as un-assigned, somebody else might like to get this deployed.\n   \n", "author": "palhmbs"}, {"message": "As a project contact, I'd also love to see notifications daily.\n   \n", "author": "jessica"}, {"message": "Hi Asheesh,\n\nThanks for the check-in. Right now I'm busy with my day job. If this is an\nurgent bug, I'm happy to relinquish it to someone else.\n\nBest\nJoshua\n\nOn Thu, Mar 31, 2011 at 1:48 PM, Asheesh Laroia &lt;<a href=\"mailto:bugs@openhatch.org\">bugs@openhatch.org</a>&gt; wrote:\n\n&gt;\n&gt; New submission from Asheesh Laroia &lt;<a href=\"mailto:asheesh@asheesh.org\">asheesh@asheesh.org</a>&gt;:\n&gt;\n&gt; Hey ablian,\n&gt;\n&gt; Let me know how this is progressing for you! Recently people have reported\n&gt; problems getting buildout to work properly, so I want to make sure things\n&gt; are\n&gt; going well for you.\n&gt;\n&gt; If you have questions about how to find the relevant code, and how it all\n&gt; runs,\n&gt; then I can also answer those -- either ask on this bug, or on the [Devel]\n&gt; list,\n&gt; or on the #openhatch IRC channel.\n&gt;\n&gt; ----------\n&gt; status: unread -&gt; chatting\n&gt;\n&gt; __________________________________________\n&gt; Roundup issue tracker &lt;<a href=\"mailto:bugs@openhatch.org\">bugs@openhatch.org</a>&gt;\n&gt; &lt;<a href=\"https://openhatch.org/bugs/issue284\">https://openhatch.org/bugs/issue284</a>&gt;\n&gt; __________________________________________\n&gt;\n   \n", "author": "abelian"}, {"message": "Hey ablian,\n\nLet me know how this is progressing for you! Recently people have reported\nproblems getting buildout to work properly, so I want to make sure things are\ngoing well for you.\n\nIf you have questions about how to find the relevant code, and how it all runs,\nthen I can also answer those -- either ask on this bug, or on the [Devel] list,\nor on the #openhatch IRC channel.\n   \n", "author": "paulproteus"}]}