{"status": "resolved", "priority": "bug", "title": "/+projects/ consistently loads surprisingly slowly", "milestone": "0.11.12", "superceder": "", "nosylist": ["aldeka, jessica, jesstess, paulproteus"], "assigned": "jesstess", "waitingon": "", "keywords": [], "id": "525", "files": [{"url": "http://openhatch.org/bugs/file442/issue525.tar.gz", "author": "jesstess"}, {"url": "http://openhatch.org/bugs/file443/issue525.tar.gz", "author": "jesstess"}], "history": [{"message": "Ya-hoo!\n   \n", "author": "paulproteus"}, {"message": "On my laptop, rendering /+projects/ still takes ages and ages.\n\nBut these are hugely great changes, and I've just deployed them in\n0c8b6184495caacc3ed1739ea3c2aa1cf8589a92\n\nFurther work is needed to make this actually fast, apparently.\n\nTo get a sense of which SQL queries are being run, I loaded\n<a href=\"http://127.0.0.1:8000/+projects/\">http://127.0.0.1:8000/+projects/</a> after adjusting settings.py to remove the\nLOGGING dict. (That way, every SQL query gets printed to the console.)\n\nLOTS of queries that look like this (Probably one per project):\n\n2012-01-08 11:43:39,499 execute:146 DEBUG    (0.282) SELECT\n`search_project`.`id`, `search_project`.`created_date`,\n`search_project`.`modified_date`, `search_project`.`name`,\n`search_project`.`display_name`, `search_project`.`homepage`,\n`search_project`.`language`, `search_project`.`icon_url`,\n`search_project`.`icon_raw`,\n`search_project`.`date_icon_was_fetched_from_ohloh`,\n`search_project`.`icon_for_profile`, `search_project`.`icon_smaller_for_badge`,\n`search_project`.`icon_for_search_result`,\n`search_project`.`logo_contains_name`,\n`search_project`.`cached_contributor_count` FROM `search_project` WHERE\n`search_project`.`id` = %s ; args=(911,)\n\nand\n\n2012-01-08 11:41:59,470 execute:146 DEBUG    (0.833) SELECT `search_bug`.`id`,\n`search_bug`.`created_date`, `search_bug`.`modified_date`,\n`search_bug`.`project_id`, `search_bug`.`title`, `search_bug`.`description`,\n`search_bug`.`status`, `search_bug`.`importance`,\n`search_bug`.`people_involved`, `search_bug`.`date_reported`,\n`search_bug`.`last_touched`, `search_bug`.`last_polled`,\n`search_bug`.`submitter_username`, `search_bug`.`submitter_realname`,\n`search_bug`.`canonical_bug_link`, `search_bug`.`good_for_newcomers`,\n`search_bug`.`looks_closed`, `search_bug`.`bize_size_tag_name`,\n`search_bug`.`concerns_just_documentation`,\n`search_bug`.`as_appears_in_distribution`, `search_bug`.`tracker_type_id`,\n`search_bug`.`tracker_id` FROM `search_bug` WHERE (`search_bug`.`looks_closed` =\n%s  AND `search_bug`.`project_id` = %s ); args=(False, 7929)\n\nSurely more. Further work should be done to shrink all that down.\n\nThis is great, though -- thanks for getting this started, jesstess!\n   \n", "author": "paulproteus"}, {"message": "These patches look good. I will deploy them shortly.\n\nSome further work on top is also needed to make this actually fast.\n   \n", "author": "paulproteus"}, {"message": "The attached tarball has a couple of commits:\n\nSpeed up /projects by using cheaper ORM queries in get_projects_with_bugs.\nRemove buildhelper-mockup.html, which is unused.\nRemove unused JS files.\n\nOn my desktop, the time difference from the ORM commit looked like this, starting up Django on a \ncold cache:\n\nBefore this commit:\n- time in projects() (time is per call, function called twice): 1.16\n- time in get_projects_with_bugs(): 2.34\n    \nAfter this commit:\n- time in projects() (time is per call, called twice): 0.19\n- time in get_projects_with_bugs(): 0.4\n\nThere is more that can be done for this ticket, but if these changes look good it'd be great to get \nthem on the live site.\n   \n", "author": "jesstess"}, {"message": "A lot of the pages load slowly and I think it's all the stuff being pulled up\nbehind the scenes. Is it possible to cache the main project listing? And maybe\nif someone adds a project that it either forces a reload or tells the person\nadding that his/her project will be available on the main page at X time?\n   \n", "author": "jessica"}, {"message": "...especially given that there's no damn icons and hardly any images on the page. \nBut the styling loads slowly in a way that visibly annoying/jarring, every time I \nopen the page. \n\nNo idea if it's a JS problem, a database-hitting problem, a caching problem, or \nmaybe all three!\n   \n", "author": "aldeka"}]}