{"status": "resolved", "priority": "bug", "title": "next= doesn't survive OpenID logins", "milestone": "0.11.02", "superceder": "", "nosylist": ["Mark, paulproteus, trisk"], "assigned": "paulproteus", "waitingon": "", "keywords": ["javascript"], "id": "72", "files": [], "history": [{"message": "It was only a problem if you were already logged in. I think JavaScript was a\nred herring.\n\nNow, if you are logged in,\n<a href=\"http://openhatch.org/account/login/?next=/wiki/Main_Page\">http://openhatch.org/account/login/?next=/wiki/Main_Page</a> sends you straight to\n<a href=\"http://openhatch.org/wiki/Main_Page\">http://openhatch.org/wiki/Main_Page</a> with a HTTP 302 redirect. Yay!\n\nResolved, I think. If someone finds a case where this is still a problem, then\nby all means\n   \n", "author": "paulproteus"}, {"message": "&lt;pythonian4000&gt; <a href=\"http://openhatch.org/account/login/?next=/wiki/Main_Page\">http://openhatch.org/account/login/?next=/wiki/Main_Page</a>\n&lt;paulproteus&gt; er, it ate it.\n&lt;paulproteus&gt; lame.\n&lt;pythonian4000&gt; Hmm, that actually worked. Derr.\n&lt;paulproteus&gt; It ate it for me, but maybe 'cause I'm logged in.\n&lt;pythonian4000&gt; Did yours not work?\n&lt;paulproteus&gt; I adjusted the link actually\n&lt;paulproteus&gt; I used\n<a href=\"https://openhatch.org/account/login/?next=http://openhatch.org/wiki/Main_Page\">https://openhatch.org/account/login/?next=http://openhatch.org/wiki/Main_Page</a>\nand <a href=\"http://openhatch.org/account/login/?next=http://openhatch.org/wiki/Main_Page\">http://openhatch.org/account/login/?next=http://openhatch.org/wiki/Main_Page</a>\n&lt;paulproteus&gt; Those failed\n&lt;paulproteus&gt; And <a href=\"http://openhatch.org/account/login/?next=/wiki/Main_Page\">http://openhatch.org/account/login/?next=/wiki/Main_Page</a> ate\nit also for me.\n&lt;paulproteus&gt; I'll leave these notes in <a href=\"issue72\">issue72</a> and debug this week.\n   \n", "author": "paulproteus"}, {"message": "This is a blocker for <a href=\"https://openhatch.org/bugs/issue264\">https://openhatch.org/bugs/issue264</a>\n   \n", "author": "pythonian4000"}, {"message": "The problem is only on http:// not https://!!!\n\nProposed next steps.\n* we wrote the post handler for openid login. let's read that carefully\n* always put people on https for login\n   \n", "author": "rafpaf"}, {"message": "OK, I've looked at this a bit more and definitely think the issue is in the\njavascript for the login links. next|urlencode is set on the links every where,\nbut something in the js must be leaving the spaces, which kills the url. If the\nurl contains no spaces or special characters, it works fine.\n\nThis is another example of one where the %20 is getting stripped.\n\n<a href=\"http://openhatch.org/account/login/?next=/%2Bprojedit/digikam%20image%20plugins\">http://openhatch.org/account/login/?next=/%2Bprojedit/digikam%20image%20plugins</a>\n\nLooks like we need a js person to take a look.\n   \n", "author": "Mark"}, {"message": "I've looked at this and all of the redirect code seems to be handled by django\nitself, unless I am missing something. The settings.LOGIN_REDIRECT_URL only\ncomes into play (which is currently set to \"/\") if a 'next' isn't specified, or\nif the url settings doesn't look for a different redirect_field_name. \n\nHere's the interesting thing, if I try it with this URL, it appears to work fine. \n\n<a href=\"http://openhatch.org/account/login/?next=/%2bprojects/pyLilyDTK\">http://openhatch.org/account/login/?next=/%2bprojects/pyLilyDTK</a>\n\nI noticed that the %20 (the space in the project name) is getting lost when the\nlink is created to log in via Google, OpenId, etc.  If the project name doesn't\ncontain the space, the redirect is fine. For some reason, I don't seem to be\nable to find the view that is generating those links. Any hints from someone\nfamiliar with that portion of the code? Note, I am not a javascript guy, if that\nis what is producing the link. It sounds like I need to learn a little. :)\n   \n", "author": "Mark"}, {"message": "I would be glad to.\n   \n", "author": "Mark"}, {"message": "I don't know if this is a bug in JavaScript, or instead in Python code that \nhandles this.\n\nMark (timewasted), if you feel like giving this a look, that would rule.\n   \n", "author": "paulproteus"}, {"message": "Wow, it is broken. That's weird -- I thought I fixed that a few weeks ago.\n   \n", "author": "paulproteus"}, {"message": "Logging in through OpenID at\n<a href=\"http://openhatch.org/account/login/?next=/%2Bprojedit/OpenSolaris%20OS/Net\">http://openhatch.org/account/login/?next=/%2Bprojedit/OpenSolaris%20OS/Net</a>\nredirects me to <a href=\"http://openhatch.org/\">http://openhatch.org/</a> instead of the expected target.\n   \n", "author": "trisk"}]}