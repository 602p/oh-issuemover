{"status": "resolved", "priority": "critical", "title": "If you submit nothing to /missions/diffpatch/diffrecursive/submit , the server crashes", "milestone": "0.11.07", "superceder": "", "nosylist": ["jesstess, paulproteus, viv"], "assigned": "viv", "waitingon": "", "keywords": ["bitesize"], "id": "463", "files": [{"url": "http://openhatch.org/bugs/file391/0001-Issue-463-Handling-IndexError-exception-including-co.patch", "author": "viv"}, {"url": "http://openhatch.org/bugs/file379/unnamed", "author": "viv"}, {"url": "http://openhatch.org/bugs/file390/unnamed", "author": "viv"}, {"url": "http://openhatch.org/bugs/file392/unnamed", "author": "viv"}, {"url": "http://openhatch.org/bugs/file393/unnamed", "author": "viv"}], "history": [{"message": "Oh Thanks.. I was kind of fiddling with Django unittests to post a file... I\nwill seek new chalange on this Saturday meeting..\n\nRegards,\n\nVivek\n\nOn Wed, Aug 31, 2011 at 11:23 AM, Asheesh Laroia &lt;<a href=\"mailto:bugs@openhatch.org\">bugs@openhatch.org</a>&gt; wrote:\n\n&gt;\n&gt; Asheesh Laroia &lt;<a href=\"mailto:asheesh@asheesh.org\">asheesh@asheesh.org</a>&gt; added the comment:\n&gt;\n&gt; Hi Vivek,\n&gt;\n&gt; I managed to merge this in locally, so you don't have to freshly rebase it.\n&gt;\n&gt; Having said that, it seems that this is already fixed in the current\n&gt; codebase.\n&gt; jesstess fixed the buggy core of the patch.py code, which makes the\n&gt; exception go\n&gt; away. So I won't push the patch that also wraps that in a try/catch\n&gt; contributed\n&gt; by viv.\n&gt;\n&gt; Sorry! )-: We should have closed this bug...\n&gt;\n&gt; Vivek, I hope you'll try your hand at another one, or help us work through\n&gt; some\n&gt; architectural changes in the future.\n&gt;\n&gt; ----------\n&gt; status: in-progress -&gt; resolved\n&gt;\n&gt; __________________________________________\n&gt; Roundup issue tracker &lt;<a href=\"mailto:bugs@openhatch.org\">bugs@openhatch.org</a>&gt;\n&gt; &lt;<a href=\"https://openhatch.org/bugs/issue463\">https://openhatch.org/bugs/issue463</a>&gt;\n&gt; __________________________________________\n&gt;\n   \n", "author": "viv"}, {"message": "Hi Vivek,\n\nI managed to merge this in locally, so you don't have to freshly rebase it.\n\nHaving said that, it seems that this is already fixed in the current codebase.\njesstess fixed the buggy core of the patch.py code, which makes the exception go\naway. So I won't push the patch that also wraps that in a try/catch contributed\nby viv.\n\nSorry! )-: We should have closed this bug...\n\nVivek, I hope you'll try your hand at another one, or help us work through some\narchitectural changes in the future.\n   \n", "author": "paulproteus"}, {"message": "Hi vivek,\n\nThis patch is not against the latest openhatch code, I think.\n\nCan you do:\n\n $ git fetch\n $ git rebase origin/master\n\nand then re-submit the change?\n\nAlso, do please write a test. As per <a href=\"issue562\">issue562</a> we're probably going to remove our\nlocal changes to patch.py, and we're definitely going to want to make sure that\nthe patch.py from <a href=\"http://code.google.com/p/python-patch/\">http://code.google.com/p/python-patch/</a> has the bug fixed also.\n\nThanks for submitting this so far!\n   \n", "author": "paulproteus"}, {"message": "Ready for review.\n\nOn Sat, Aug 27, 2011 at 2:56 PM, Vivek Shrivastava &lt;<a href=\"mailto:vivshrivastava@gmail.com\">vivshrivastava@gmail.com</a>\n&gt; wrote:\n\n&gt; Hi Asheesh,\n&gt;\n&gt; I should be able to do it by Aug 31.\n&gt;\n&gt; Thanks,\n&gt;\n&gt; VIvke\n&gt;\n&gt;\n&gt; On Sat, Aug 27, 2011 at 2:54 PM, Asheesh Laroia &lt;<a href=\"mailto:bugs@openhatch.org\">bugs@openhatch.org</a>&gt;wrote:\n&gt;\n&gt;&gt;\n&gt;&gt; Asheesh Laroia &lt;<a href=\"mailto:asheesh@asheesh.org\">asheesh@asheesh.org</a>&gt; added the comment:\n&gt;&gt;\n&gt;&gt; Hey vivek,\n&gt;&gt;\n&gt;&gt; Let us know how things are going. If you're not going to have time for\n&gt;&gt; this, and\n&gt;&gt; still want it to be part of 0.11.07, I could maybe try to tackle it. I'll\n&gt;&gt; leave\n&gt;&gt; it for last, to give you as much time as possible. The milestone ends Aug\n&gt;&gt; 31, so\n&gt;&gt; I'll probably start looking at it on that date if I don't hear any more\n&gt;&gt; from you.\n&gt;&gt;\n&gt;&gt; Normally I'd just push it out of the milestone, but crasher bugs are sad\n&gt;&gt; for\n&gt;&gt; users.\n&gt;&gt;\n&gt;&gt; __________________________________________\n&gt;&gt; Roundup issue tracker &lt;<a href=\"mailto:bugs@openhatch.org\">bugs@openhatch.org</a>&gt;\n&gt;&gt; &lt;<a href=\"https://openhatch.org/bugs/issue463\">https://openhatch.org/bugs/issue463</a>&gt;\n&gt;&gt; __________________________________________\n&gt;&gt;\n&gt;\n&gt;\n   \n", "author": "viv"}, {"message": "Please review the changes. I would need to more time to write test if that is \nnecessary.\n   \n", "author": "viv"}, {"message": "Hi Asheesh,\n\nI should be able to do it by Aug 31.\n\nThanks,\n\nVIvke\n\nOn Sat, Aug 27, 2011 at 2:54 PM, Asheesh Laroia &lt;<a href=\"mailto:bugs@openhatch.org\">bugs@openhatch.org</a>&gt; wrote:\n\n&gt;\n&gt; Asheesh Laroia &lt;<a href=\"mailto:asheesh@asheesh.org\">asheesh@asheesh.org</a>&gt; added the comment:\n&gt;\n&gt; Hey vivek,\n&gt;\n&gt; Let us know how things are going. If you're not going to have time for\n&gt; this, and\n&gt; still want it to be part of 0.11.07, I could maybe try to tackle it. I'll\n&gt; leave\n&gt; it for last, to give you as much time as possible. The milestone ends Aug\n&gt; 31, so\n&gt; I'll probably start looking at it on that date if I don't hear any more\n&gt; from you.\n&gt;\n&gt; Normally I'd just push it out of the milestone, but crasher bugs are sad\n&gt; for\n&gt; users.\n&gt;\n&gt; __________________________________________\n&gt; Roundup issue tracker &lt;<a href=\"mailto:bugs@openhatch.org\">bugs@openhatch.org</a>&gt;\n&gt; &lt;<a href=\"https://openhatch.org/bugs/issue463\">https://openhatch.org/bugs/issue463</a>&gt;\n&gt; __________________________________________\n&gt;\n   \n", "author": "viv"}, {"message": "Hey vivek,\n\nLet us know how things are going. If you're not going to have time for this, and \nstill want it to be part of 0.11.07, I could maybe try to tackle it. I'll leave \nit for last, to give you as much time as possible. The milestone ends Aug 31, so \nI'll probably start looking at it on that date if I don't hear any more from you.\n\nNormally I'd just push it out of the milestone, but crasher bugs are sad for \nusers.\n   \n", "author": "paulproteus"}, {"message": "Hi  Jessica,\n\nI am sorry for keeping you updated..Actually I am kind of out of country\nright now.. I will finish this task or inform you about the progress by the\nend of this month.\n\nThanks,\n\nVivek\n\nOn Sun, Aug 7, 2011 at 11:50 PM, jesstess &lt;<a href=\"mailto:bugs@openhatch.org\">bugs@openhatch.org</a>&gt; wrote:\n\n&gt;\n&gt; jesstess &lt;<a href=\"mailto:jessica.mckellar@gmail.com\">jessica.mckellar@gmail.com</a>&gt; added the comment:\n&gt;\n&gt; viv: I wanted to check in and see how things were going on this ticket. Do\n&gt; you have an\n&gt; implementation plan you are happy with, and do you need any help or\n&gt; feedback?\n&gt;\n&gt; ----------\n&gt; nosy: +jesstess\n&gt;\n&gt; __________________________________________\n&gt; Roundup issue tracker &lt;<a href=\"mailto:bugs@openhatch.org\">bugs@openhatch.org</a>&gt;\n&gt; &lt;<a href=\"https://openhatch.org/bugs/issue463\">https://openhatch.org/bugs/issue463</a>&gt;\n&gt; __________________________________________\n&gt;\n   \n", "author": "viv"}, {"message": "viv: I wanted to check in and see how things were going on this ticket. Do you have an \nimplementation plan you are happy with, and do you need any help or feedback?\n   \n", "author": "jesstess"}, {"message": "Assigning it to myself.\n   \n", "author": "viv"}, {"message": "If you submit the empty value to /missions/diffpatch/diffrecursive/submit , then\nthe server hits an unhandled exception.\n\nThis should be fixed! It's also a good opportunity to write a test. A\ngood-quality way to fix this is:\n\n* Write a test that logs in and does a POST to\n/missions/diffpatch/diffrecursive/submit\n\n* Verify that you can reproduce the crash\n\n* Modify the view so that the test does not crash\n\n* Submit a patch (-:\n\nThis is the stack trace you should expect to see.\n\nTraceback (most recent call last):\n\n  File\n\"/home/deploy/milestone-a.buildout/parts/production/django/core/handlers/base.py\",\nline 100, in get_response\n    response = callback(request, *callback_args, **callback_kwargs)\n\n  File\n\"/home/deploy/milestone-a.buildout/parts/production/django/contrib/auth/decorators.py\",\nline 25, in _wrapped_view\n    return view_func(request, *args, **kwargs)\n\n  File \"/home/deploy/milestone-a.buildout/mysite/missions/diffpatch/views.py\",\nline 91, in diffrecursive_submit\n   \ncontrollers.DiffRecursiveMission.validate_patch(form.cleaned_data['diff'].read())\n\n  File\n\"/home/deploy/milestone-a.buildout/mysite/missions/diffpatch/controllers.py\",\nline 76, in validate_patch\n    the_patch = patch.fromstring(patchdata)\n\n  File \"/home/deploy/milestone-a.buildout/mysite/missions/base/patch.py\", line\n67, in fromstring\n    return Patch( StringIO(s) )\n\n  File \"/home/deploy/milestone-a.buildout/mysite/missions/base/patch.py\", line\n118, in __init__\n    self.parse(stream)\n\n  File \"/home/deploy/milestone-a.buildout/mysite/missions/base/patch.py\", line\n325, in parse\n    self.hunks[nextfileno-1].append(hunkinfo.copy())\n\nIndexError: list index out of range\n   \n", "author": "paulproteus"}]}